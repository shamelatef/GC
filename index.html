
<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Gantt Chart with Groups</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Dynamic Gantt Chart - Infrastructure</h1>
            <p>BY Shamel Radwan & AI</p>
            <div id="saveIndicator" style="margin-top: 10px; font-size: 0.9rem; font-weight: 600;">✓ All changes saved</div>
        </div>

        <div class="project-tabs" id="projectTabs"></div>
        
        <!-- Rename Project Modal -->
        <div class="modal-backdrop" id="renameModal">
            <div class="modal" role="dialog" aria-modal="true" aria-labelledby="renameTitle">
                <h3 id="renameTitle">Rename Project</h3>
                <div class="modal-body">
                    <input type="text" id="renameProjectInput" placeholder="Project name" />
                </div>
                <div class="actions">
                    <button class="btn btn-secondary btn-secondary-ghost" onclick="closeRenameModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="confirmRenameModal()">Save</button>
                </div>
            </div>
        </div>

        <!-- Edit Modal (for task/group edits) -->
        <div class="modal-backdrop" id="editModal" style="display: none;">
            <div class="modal" role="dialog" aria-modal="true" aria-labelledby="editTitle">
                <h3 id="editTitle">Edit</h3>
                <div class="modal-body">
                    <input type="text" id="editInput" placeholder="Enter value" />
                </div>
                <div class="actions">
                    <button class="btn btn-secondary btn-secondary-ghost" onclick="closeEditModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="confirmEditModal()">Save</button>
                </div>
            </div>
        </div>

        <!-- Edit Dates Modal -->
        <div class="modal-backdrop" id="dateModal" style="display:none">
            <div class="modal" role="dialog" aria-modal="true" aria-labelledby="dateTitle">
                <h3 id="dateTitle">Edit Task Dates</h3>
                <div class="modal-body" style="display:grid; gap:12px;">
                    <label style="display:grid; gap:6px;">
                        <span>Start Date</span>
                        <input type="date" id="dateStartInput" />
                    </label>
                    <label style="display:grid; gap:6px;">
                        <span>End Date</span>
                        <input type="date" id="dateEndInput" />
                    </label>
                </div>
                <div class="actions">
                    <button class="btn btn-secondary btn-secondary-ghost" onclick="closeDateModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="confirmDateModal()">Save</button>
                </div>
            </div>
        </div>

        <!-- Edit Color Modal -->
        <div class="modal-backdrop" id="colorModal" style="display:none">
            <div class="modal" role="dialog" aria-modal="true" aria-labelledby="colorTitle">
                <h3 id="colorTitle">Change Task Color</h3>
                <div class="modal-body" style="display:grid; gap:12px;">
                    <div class="color-palette" id="colorPalette">
                        <div class="palette-section">
                            <div class="palette-title">Theme Colors</div>
                            <div class="swatches">
                                <button class="swatch" data-color="#000000" style="--c:#000000" aria-label="Black"></button>
                                <button class="swatch" data-color="#7F7F7F" style="--c:#7F7F7F" aria-label="Dark Gray"></button>
                                <button class="swatch" data-color="#C00000" style="--c:#C00000" aria-label="Dark Red"></button>
                                <button class="swatch" data-color="#FF0000" style="--c:#FF0000" aria-label="Red"></button>
                                <button class="swatch" data-color="#FFC000" style="--c:#FFC000" aria-label="Orange"></button>
                                <button class="swatch" data-color="#FFFF00" style="--c:#FFFF00" aria-label="Yellow"></button>
                                <button class="swatch" data-color="#92D050" style="--c:#92D050" aria-label="Green"></button>
                                <button class="swatch" data-color="#00B050" style="--c:#00B050" aria-label="Dark Green"></button>
                                <button class="swatch" data-color="#00B0F0" style="--c:#00B0F0" aria-label="Blue"></button>
                                <button class="swatch" data-color="#0070C0" style="--c:#0070C0" aria-label="Dark Blue"></button>
                                <button class="swatch" data-color="#002060" style="--c:#002060" aria-label="Navy"></button>
                                <button class="swatch" data-color="#7030A0" style="--c:#7030A0" aria-label="Purple"></button>
                            </div>
                        </div>
                        <div class="palette-section">
                            <div class="palette-title">Standard Colors</div>
                            <div class="swatches">
                                <button class="swatch" data-color="#FFFFFF" style="--c:#FFFFFF" aria-label="White"></button>
                                <button class="swatch" data-color="#E7E6E6" style="--c:#E7E6E6" aria-label="Light Gray"></button>
                                <button class="swatch" data-color="#F2F2F2" style="--c:#F2F2F2" aria-label="Very Light Gray"></button>
                                <button class="swatch" data-color="#1F497D" style="--c:#1F497D" aria-label="Dark Steel"></button>
                                <button class="swatch" data-color="#4F81BD" style="--c:#4F81BD" aria-label="Steel Blue"></button>
                                <button class="swatch" data-color="#9BBB59" style="--c:#9BBB59" aria-label="Olive Green"></button>
                                <button class="swatch" data-color="#8064A2" style="--c:#8064A2" aria-label="Lavender"></button>
                                <button class="swatch" data-color="#C0504D" style="--c:#C0504D" aria-label="Brick Red"></button>
                                <button class="swatch" data-color="#4BACC6" style="--c:#4BACC6" aria-label="Teal"></button>
                                <button class="swatch" data-color="#F79646" style="--c:#F79646" aria-label="Light Orange"></button>
                            </div>
                        </div>
                        <div class="palette-section" id="recentSection" style="display:none;">
                            <div class="palette-title">Recent Colors</div>
                            <div class="swatches" id="recentColors"></div>
                        </div>
                    </div>
                    <div class="palette-actions">
                        <button class="btn btn-secondary btn-secondary-ghost" id="moreColorsBtn" type="button">More Colors…</button>
                    </div>
                    <input type="color" id="colorInput" style="display:none" />
                </div>
                <div class="actions">
                    <button class="btn btn-secondary btn-secondary-ghost" onclick="closeColorModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="confirmColorModal()">Save</button>
                </div>
            </div>
        </div>

        <!-- Add Task Modal -->
        <div class="modal-backdrop" id="addTaskModal" style="display:none">
            <div class="modal" role="dialog" aria-modal="true" aria-labelledby="addTaskTitle">
                <h3 id="addTaskTitle">Add Task</h3>
                <div class="modal-body" style="display:grid; gap:12px;">
                    <label style="display:grid; gap:6px;">
                        <span>Task Name</span>
                        <input type="text" id="addTaskNameInput" placeholder="Enter task name" />
                    </label>
                    <label style="display:grid; gap:6px;">
                        <span>Group</span>
                        <input type="text" id="addTaskGroupName" readonly />
                    </label>
                    <label style="display:grid; gap:6px;">
                        <span>Start Date</span>
                        <input type="date" id="addTaskStartDate" />
                    </label>
                    <label style="display:grid; gap:6px;">
                        <span>End Date</span>
                        <input type="date" id="addTaskEndDate" />
                    </label>
                    <label style="display:grid; gap:6px;">
                        <span>Task Color</span>
                        <div style="display:flex; gap:8px; align-items:center;">
                            <div id="addTaskColorPreview" class="color-preview-chip" title="Current color"></div>
                            <input type="hidden" id="addTaskColor" value="#667eea" />
                            <button type="button" class="btn btn-secondary btn-secondary-ghost" style="flex:0 0 auto; padding:6px 10px; border-radius:8px; font-size:0.8rem;" onclick="openColorPickerForInput('addTaskColor','Choose Task Color')">Palette</button>
                        </div>
                    </label>
                </div>
                <div class="actions">
                    <button class="btn btn-secondary btn-secondary-ghost" onclick="closeAddTaskModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="confirmAddTaskModal()">Add</button>
                </div>
            </div>
        </div>

        <div class="controls">
            <div class="form-group">
                <label for="taskName">Task Name</label>
                <input type="text" id="taskName" placeholder="Enter task name">
            </div>
            <div class="form-group">
                <label for="groupName">Group</label>
                <div class="group-input-wrapper">
                    <div id="groupGhost" class="group-ghost" aria-hidden="true"></div>
                    <input type="text" id="groupName" placeholder="Enter group name" list="groupSuggestions">
                </div>
                <datalist id="groupSuggestions"></datalist>
                <div id="groupHint" class="input-hint" aria-live="polite">Press Tab to autocomplete</div>
            </div>
            <div class="form-group">
                <label for="startDate">Start Date</label>
                <input type="date" id="startDate">
            </div>
            <div class="form-group">
                <label for="endDate">End Date</label>
                <input type="date" id="endDate">
            </div>
            <div class="form-group">
                <label for="taskColor">Task Color</label>
                <div style="display:flex; gap:8px; align-items:center;">
                    <div id="taskColorPreview" class="color-preview-chip" title="Current color"></div>
                    <input type="hidden" id="taskColor" value="#667eea">
                    <button type="button" class="btn btn-secondary btn-secondary-ghost" style="flex:0 0 auto; padding:6px 10px; border-radius:8px; font-size:0.8rem;" onclick="openColorPickerForInput('taskColor','Choose Task Color')">Palette</button>
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="addTask()">Add Task</button>
                <button class="btn btn-tertiary" onclick="toggleAllGroups()">Collapse All</button>
                <button class="btn btn-success" onclick="saveToFile()">Save File</button>
                <button class="btn btn-info" onclick="document.getElementById('fileInput').click()">Load File</button>

                <!-- Overflow menu for less-frequent actions -->
                <div class="kebab-menu" style="margin-left:auto;">
                    <button class="btn" onclick="event.stopPropagation(); toggleKebabMenu(this)" aria-haspopup="true" aria-expanded="false">More ▾</button>
                    <div class="kebab-dropdown" role="menu">
                        <div class="kebab-item" role="menuitem" onclick="saveChartAsPNG(); this.closest('.kebab-dropdown')?.classList.remove('show');">
                            <span class="kebab-item-icon">🖼️</span>
                            <span>Save PNG</span>
                        </div>

                        <div class="kebab-item" role="menuitem" onclick="document.getElementById('excelInput').click(); this.closest('.kebab-dropdown')?.classList.remove('show');">
                            <span class="kebab-item-icon">⬇️</span>
                            <span>Import (CSV/XLSX)</span>
                        </div>
                        <div class="kebab-item" role="menuitem" onclick="exportCSV(); this.closest('.kebab-dropdown')?.classList.remove('show');">
                            <span class="kebab-item-icon">📤</span>
                            <span>Export CSV</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <input type="file" id="fileInput" class="file-input" accept=".json" onchange="loadFromFile(this)">
        <input type="file" id="excelInput" class="file-input" accept=".xlsx,.csv" onchange="importFromExcel(this)">

        <div class="groups-list" id="groupsList" style="display:none" aria-hidden="true"></div>

        <div class="chart-container">
            <div class="chart" id="ganttChart">
                <div class="no-tasks">Add tasks to see your Gantt chart</div>
            </div>
        </div>
    </div>

    <script src="main.js"></script>
</body>
</html>